
%
% perform dictionary learning based on PCA
% map each data vector to its PCA representation and do DL on new data
% 

%% prepare DL
clear 

addpath("Help_Functions"); %make help functions available
addpath("Preprocess");
addpath("Data");

FILENAME = "Restoration.txt";
SUBSET_LEN = 896; % should be > 64 to avoid too many zeros in diag(A)
BLOCK_LEN = 32; % data subset will have SUBSET_LEN^2 / BLOCK_LEN^2 vectors
   
% read data into block form
[U, original] = ascii_to_data_matrix(FILENAME, SUBSET_LEN, BLOCK_LEN); 

data = patches_to_original(U, BLOCK_LEN, SUBSET_LEN, SUBSET_LEN);

num_atoms = 200;
lambda = .1;
max_iter = 50;
dict_iter = 15;
dict_tol = 1e-6;

[D, X, A, B, updated, n, i] = dictionary_learning(U, num_atoms, ...
                                lambda, dict_tol, max_iter, dict_iter);